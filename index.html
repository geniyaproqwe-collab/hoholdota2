<script>
    // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±—É–¥—É—Ç –ø–æ–ª—É—á–∞—Ç—å—Å—è –∏–∑ –±–æ—Ç–∞)
    let userData = {
        tg: 0,
        rub: 0,
        star: 0
    };
    
    // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Å–µ—Ç–æ–≤ (–±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è —á–µ—Ä–µ–∑ API)
    let setsData = [];
    
    // API URL
    const API_URL = "http://localhost:5000/api";
    
    async function loadSets() {
        try {
            const response = await fetch(`${API_URL}/sets`);
            const data = await response.json();
            
            if (data.success) {
                setsData = data.sets;
                displaySets();
            } else {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ç–æ–≤:', data.error);
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ç–æ–≤');
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞:', error);
            showError('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ç—ã');
        }
    }
    
    function displaySets() {
        const container = document.getElementById('sets-container');
        
        if (setsData.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <h3>üõçÔ∏è –°–ï–¢–û–í –ü–û–ö–ê –ù–ï–¢</h3>
                    <p>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç —Å–µ—Ç</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = '';
        
        setsData.forEach(set => {
            const setCard = `
                <div class="set-card">
                    <img src="${set.image}" alt="${set.name}" class="set-image" 
                         onerror="this.src='https://via.placeholder.com/400x200/667eea/ffffff?text=No+Image'">
                    <div class="set-info">
                        <div class="set-name">${set.name}</div>
                        <div class="set-description">${set.description}</div>
                        <div class="set-prices">
                            <span class="price price-tg">${set.prices.tg.toLocaleString()} ‚Ç∏</span>
                            <span class="price price-rub">${set.prices.rub.toLocaleString()} ‚ÇΩ</span>
                            <span class="price price-star">${set.prices.star.toLocaleString()} ‚≠ê</span>
                        </div>
                        <button class="buy-btn" onclick="buySet(${set.id})">üõí –ö–£–ü–ò–¢–¨</button>
                        <div class="seller-info">–ü—Ä–æ–¥–∞–≤–µ—Ü: @${set.seller}</div>
                    </div>
                </div>
            `;
            container.innerHTML += setCard;
        });
    }
    
    function buySet(setId) {
        const set = setsData.find(s => s.id === setId);
        if (!set) return;
        
        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –±–æ—Ç–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏
        window.open(`https://t.me/sellernevertime_bot?start=buy_${setId}`, '_blank');
    }
    
    function showError(message) {
        const container = document.getElementById('sets-container');
        container.innerHTML = `
            <div class="empty-state">
                <h3>‚ùå –û–®–ò–ë–ö–ê</h3>
                <p>${message}</p>
                <button onclick="loadSets()" style="margin-top: 10px; padding: 10px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                    üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                </button>
            </div>
        `;
    }
    
    function updateBalance() {
        document.getElementById('balance-tg').textContent = userData.tg.toLocaleString() + ' ‚Ç∏';
        document.getElementById('balance-rub').textContent = userData.rub.toLocaleString() + ' ‚ÇΩ';
        document.getElementById('balance-star').textContent = userData.star.toLocaleString() + ' ‚≠ê';
    }
    
    function showTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.add('hidden');
        });
        document.getElementById(tabName).classList.remove('hidden');
        
        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('active');
        });
        event.target.classList.add('active');
    }
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    document.addEventListener('DOMContentLoaded', function() {
        loadSets();
        updateBalance();
        
        // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Web App
        if (window.Telegram && window.Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
        }
    });
</script>